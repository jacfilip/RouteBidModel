using Revise
using Pkg
Pkg.activate(".")
using RouteBidModel
using DataFrames
using Random
Random.seed!(0);
p = BidModelParams(ct = [0.00749, 0.00640, 0.00837, 0.00689, 0.00563, 0.00751, 0.00791, 0.00732, 0.00746, 0.00655, 0.00646, 0.00565, 0.00509, 0.00716, 0.00660, 0.00664, 0.00729, 0.00763, 0.00809, 0.00612, 0.00638, 0.00708, 0.00632, 0.00736, 0.00592, 0.00720, 0.00702, 0.00728, 0.00626, 0.00714, 0.00617, 0.00467, 0.00812, 0.00625, 0.00529, 0.00582, 0.00643, 0.00679, 0.00629, 0.00700, 0.00650, 0.00838, 0.00720, 0.00768, 0.00725, 0.00693, 0.00744, 0.00481, 0.00666, 0.00556, 0.00705, 0.00728, 0.00672, 0.00656, 0.00724, 0.00784, 0.00576, 0.00686, 0.00788, 0.00586, 0.00534, 0.00773, 0.00637, 0.00692, 0.00635, 0.00629, 0.00741, 0.00654, 0.00690, 0.00637, 0.00774, 0.00718, 0.00713, 0.00594, 0.00637, 0.00585, 0.00667, 0.00706, 0.00654, 0.00729, 0.00613, 0.00757, 0.00653, 0.00656, 0.00646, 0.00663, 0.00615, 0.00670, 0.00646, 0.00698, 0.00747, 0.00645, 0.00623, 0.00592, 0.00635, 0.00646, 0.00833, 0.00526, 0.00787, 0.00864, 0.00553, 0.00768, 0.00613, 0.00788, 0.00459, 0.00737, 0.00797, 0.00562, 0.00649, 0.00621, 0.00594, 0.00624, 0.00699, 0.00867, 0.00684, 0.00723, 0.00783, 0.00649, 0.00790, 0.00621, 0.00608, 0.00706, 0.00692, 0.00711, 0.00637, 0.00768, 0.00660, 0.00505, 0.00643, 0.00732, 0.00628, 0.00686, 0.00820, 0.00705, 0.00610, 0.00491, 0.00567, 0.00673, 0.00688, 0.00724, 0.00674, 0.00742, 0.00690, 0.00720, 0.00639, 0.00686, 0.00781, 0.00832, 0.00730, 0.00851, 0.00712, 0.00667, 0.00722, 0.00503, 0.00821, 0.00694, 0.00670, 0.00646, 0.00689, 0.00638, 0.00644, 0.00534, 0.00631, 0.00622, 0.00718, 0.00648, 0.00732, 0.00562, 0.00689, 0.00726, 0.00831, 0.00581, 0.00525, 0.00917, 0.00579, 0.00860, 0.00656, 0.00632, 0.00695, 0.00735, 0.00562, 0.00672, 0.00829, 0.00566, 0.00834, 0.00639, 0.00876, 0.00702, 0.00687, 0.00831, 0.00674, 0.00593, 0.00654, 0.00662, 0.00577, 0.00588, 0.00521, 0.00732, 0.00716, 0.00748, 0.00782, 0.00742, 0.00743, 0.00849, 0.00607, 0.00694, 0.00672, 0.00567, 0.00802, 0.00791, 0.00655, 0.00686, 0.00800, 0.00539, 0.00688, 0.00639, 0.00710, 0.00628, 0.00620, 0.00670, 0.00649, 0.00684, 0.00723, 0.00571, 0.00560, 0.00850, 0.00617, 0.00681, 0.00618, 0.00758, 0.00620, 0.00653, 0.00501, 0.00750, 0.00650, 0.00719, 0.00710, 0.00736, 0.00668, 0.00659, 0.00656, 0.00934, 0.00588, 0.00796, 0.00746, 0.00743, 0.00641, 0.00668, 0.00656, 0.00583, 0.00711, ])

ne = solve_nash_time(p)

ne_cost = cost(p,ne)
sum(ne_cost)

opt = solve_travel(p)
sum(opt.cost)

Random.seed!(0);
bid6 = 6 .+ rand(length(p.ct))./100
res6 = play_nash(p,bid6; N_STEPS=200)
sol6 = solve_travel(p,res6.bid)
sum(sol6.cost)
d6=DataFrame(x=sol6.x,p=p.ct, bid=res6.bid)
display(sort(d6,:p))

Random.seed!(0);
bid12 = 12 .+ rand(length(p.ct))./100
res12 = play_nash(p,bid12; N_STEPS=200)
sol12 = solve_travel(p,res12.bid)
sum(sol12.cost)
d12=DataFrame(x=sol12.x,p=p.ct, bid=res12.bid)
display(sort(d12,:bid))

Random.seed!(0);
bid_rand = 5 .+ rand(length(p.ct)) .* 10
res_rand = play_nash(p,bid_rand; N_STEPS=200)
sol_rand = solve_travel(p,res_rand.bid)
sum(sol_rand.cost)
d_rand=DataFrame(x=sol_rand.x,p=p.ct, bid=res_rand.bid)
display(sort(d_rand,:p))
